def build_prompt(data, mode, prev):
    time_label = "18:07" if mode == "1807" else "6:07"

    return f"""
━━━━━━━━━━━━━━━━━━
【米国株 市場レビュー】{time_label} JST
（米国株 / 半導体・NVDA中心）
━━━━━━━━━━━━━━━━━━

【厳守ルール】
・数値の計算・判定は禁止
・与えられたデータのみ使用
・NVDA と 半導体（SOX）を同量・同粒度で分析
・投資助言は禁止
・断定表現は禁止

【市場データ（確定）】
{data}

【前回18:07シナリオ（6:07のみ）】
{prev}

【出力構成（変更禁止）】
1. NVDA 分析
2. 半導体セクター（SOX）分析
3. NASDAQ 補足
4. ニュース（①前日評価 ②最新 ③1週間）
5. 米国政治・金融政策（短期/中期/トレンド）
6. { '【18:07 シナリオ】' if mode=='1807' else '【検証】' }

最後に必ず以下を付ける：
━━━━━━━━━━━━━━━━━━
※ 自動生成 / 投資助言ではありません
"""
